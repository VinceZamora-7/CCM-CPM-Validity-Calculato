<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CCM/CPM Validity Calculator</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="wrap" aria-label="CCM/CPM Validity Calculator">
    <!-- Calculator -->
    <section class="card" aria-labelledby="pageTitle">
      <header class="head">
        <div class="title">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1 id="pageTitle">CCM/CPM Validity Calculator</h1>
            <p class="sub" id="todayText" aria-live="polite"></p>
          </div>
        </div>

        <div class="head-actions">
          <div class="pill" aria-label="Rules summary">
            CPM + 4 calendar days • CCM + N business days
          </div>

          <div class="theme-toggle" role="group" aria-label="Theme toggle">
            <button id="btnDark" type="button" class="active" aria-label="Switch to dark mode">Dark</button>
            <button id="btnLight" type="button" aria-label="Switch to light mode">Light</button>
          </div>
        </div>
      </header>

      <div class="body">
        <form id="calcForm" novalidate>
          <!-- Subsidiary -->
          <fieldset>
            <legend class="sr-only">Subsidiary selection</legend>

            <label for="subsidiaryInput">Subsidiary</label>

            <div
              class="combo"
              id="combo"
              role="combobox"
              aria-haspopup="listbox"
              aria-expanded="false"
              aria-owns="comboList"
            >
              <div class="combo-field">
                <input
                  id="subsidiaryInput"
                  class="combo-input"
                  type="text"
                  placeholder="Click arrow or type to search…"
                  autocomplete="off"
                  aria-autocomplete="list"
                  aria-controls="comboList"
                  aria-describedby="rangeHint unknownHint"
                />
                <button class="combo-btn" id="comboBtn" type="button" aria-label="Open dropdown">
                  ▾
                </button>
              </div>

              <div class="combo-menu" id="comboMenu">
                <div class="combo-list" id="comboList" role="listbox" aria-label="Subsidiary options"></div>
              </div>
            </div>

            <p class="small" id="rangeHint">CCM Range: —</p>
            <p class="small warn-text" id="unknownHint" style="display:none;">
              Please select a valid subsidiary from the dropdown.
            </p>
          </fieldset>

          <!-- Dates -->
          <fieldset class="mt-12">
            <legend class="sr-only">Dates</legend>

            <div class="row">
              <div>
                <label for="ccmDate">CCM Date</label>
                <input id="ccmDate" type="date" aria-label="CCM Date" />
              </div>

              <div>
                <label for="cpmDate">CPM Date</label>
                <input id="cpmDate" type="date" aria-label="CPM Date" />
              </div>
            </div>
          </fieldset>

          <!-- Actions -->
          <div class="btns" role="group" aria-label="Calculator actions">
            <button class="primary" style="display: none;" type="button" id="calcBtn">Calculate</button>
            <button type="button" id="resetBtn">Reset</button>
            <button type="button" id="copyBtn">Copy Result</button>
          </div>

          <p class="hint" aria-label="Formula details">
            <b>CPM END</b> = CPM Date + <b>4 calendar days</b><br />
            <b>CCM END</b> = CCM Date + <b>N business days</b> (based on subsidiary)<br />
            If <b>Today &gt; END Date</b> ⇒ expired. If either expired ⇒ <b>DATA NOT VALID</b>.
          </p>
        </form>
      </div>
    </section>

    <!-- Result -->
    <section class="card" aria-labelledby="resultTitle">
      <header class="head">
        <p class="sub" id="resultTitle">Result</p>
        <div class="sub" aria-hidden="true">Valid / Not Valid</div>
      </header>

      <div class="body">
        <div class="status" aria-live="polite" aria-atomic="true">
          <div class="chip" id="overallChip">
            <span class="dot" aria-hidden="true"></span>
            <span id="overallText">Waiting for input</span>
          </div>
          <div class="sub" id="overallShort">—</div>
        </div>

        <div class="kv" role="list" aria-label="Calculated fields">
          <div class="item" role="listitem">
            <div class="k">CPM END Date</div>
            <div class="v" id="cpmEnd">—</div>
          </div>

          <div class="item" role="listitem">
            <div class="k">CPM Status</div>
            <div class="v" id="cpmStatus">—</div>
          </div>

          <div class="item" role="listitem">
            <div class="k">CCM END Date</div>
            <div class="v" id="ccmEnd">—</div>
          </div>

          <div class="item" role="listitem">
            <div class="k">CCM Status</div>
            <div class="v" id="ccmStatus">—</div>
          </div>
        </div>

        <label class="sr-only" for="jsonOut">Result JSON</label>
        <textarea id="jsonOut" readonly placeholder="Result JSON will appear here..."></textarea>
      </div>
    </section>

    <div class="toast" id="toast" role="status" aria-live="polite">Copied!</div>
  </main>

  <script src="script.js"></script>
</body>
</html>
